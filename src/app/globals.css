@import 'tailwindcss';

@layer base {
  :root {
    /* 使用 HSL 颜色格式，更直观且易于调整 */
    --foreground: 0 0% 0%;
    --background-start: 214 14% 85%;
    --background-end: 0 0% 100%;
    
    /* 滚动条颜色变量 */
    --scrollbar-track: 0 0% 96%;
    --scrollbar-thumb: 0 0% 53%;
    --scrollbar-thumb-hover: 0 0% 33%;
    
    /* 添加设计系统变量 */
    --radius-sm: 0.25rem;
    --radius-md: 0.375rem;
    --radius-lg: 0.5rem;
    
    /* 动画变量 */
    --transition-fast: 150ms;
    --transition-base: 250ms;
    --transition-slow: 350ms;
  }
  
  /* 暗色模式支持 */
  @media (prefers-color-scheme: dark) {
    :root {
      --foreground: 0 0% 100%;
      --background-start: 0 0% 7%;
      --background-end: 0 0% 13%;
      --scrollbar-track: 0 0% 15%;
      --scrollbar-thumb: 0 0% 40%;
      --scrollbar-thumb-hover: 0 0% 60%;
    }
  }
  
  /* 基础重置 - 使用现代 CSS 属性 */
  *,
  *::before,
  *::after {
    box-sizing: border-box;
    margin: 0;
    padding: 0;
    min-width: 0; /* 防止元素过大 */
  }

  /* 性能优化：滚动性能 */
  html {
    max-width: 100vw;
    overflow-x: hidden;
    -webkit-font-smoothing: antialiased;
    -moz-osx-font-smoothing: grayscale;
    text-size-adjust: 100%;
    text-rendering: optimizeLegibility;
  }

  /* 优化渲染性能 */
  body {
    color: hsl(var(--foreground));
    background-image: linear-gradient(
      to bottom,
      hsl(var(--background-start)),
      hsl(var(--background-end))
    );
    background-attachment: fixed; /* 创建视差效果 */
    min-height: 100vh;
    min-height: 100dvh; /* 考虑动态视口高度 */
    position: relative;
    isolation: isolate; /* 创建新的层叠上下文 */
  }

  /* 改进的焦点样式 */
  :focus-visible {
    outline: 2px solid hsl(210 100% 50%);
    outline-offset: 2px;
  }

  /* 选择文本样式 */
  ::selection {
    background-color: hsl(210 100% 50% / 0.3);
    color: hsl(var(--foreground));
  }
}

@layer utilities {
  /* 自定义滚动条 - 支持 Firefox 和现代浏览器 */
  .scrollbar-custom {
    scrollbar-width: thin;
    scrollbar-color: hsl(var(--scrollbar-thumb)) hsl(var(--scrollbar-track));
  }
  
  .scrollbar-custom::-webkit-scrollbar {
    width: 8px;
    height: 8px;
  }
  
  .scrollbar-custom::-webkit-scrollbar-track {
    background: hsl(var(--scrollbar-track));
    border-radius: var(--radius-md);
  }
  
  .scrollbar-custom::-webkit-scrollbar-thumb {
    background: hsl(var(--scrollbar-thumb));
    border-radius: var(--radius-md);
    transition: background-color var(--transition-base) ease;
  }
  
  .scrollbar-custom::-webkit-scrollbar-thumb:hover {
    background: hsl(var(--scrollbar-thumb-hover));
  }
  
  /* 滚动条边角 */
  .scrollbar-custom::-webkit-scrollbar-corner {
    background: hsl(var(--scrollbar-track));
  }
  
  /* 代码编辑器优化 */
  .code-editor {
    tab-size: 2;
    -moz-tab-size: 2;
    tab-size: 2;
    
    /* 字体优化 */
    font-feature-settings: "ss01", "ss02", "cv01", "cv02";
    font-variant-ligatures: contextual;
    -webkit-font-variant-ligatures: contextual;
    font-variant-numeric: tabular-nums;
  }
  
  /* 预览区域优化 */
  .preview-content {
    /* 改进的文本渲染 */
    word-break: break-word;
    overflow-wrap: anywhere;
    hyphens: auto;
    
    /* 容器查询支持 */
    container-type: inline-size;
    
    /* 图片处理 */
    img {
      max-width: 100%;
      height: auto;
      display: block;
    }
    
    /* 代码块优化 */
    pre {
      overflow-x: auto;
      padding: 1rem;
      border-radius: var(--radius-md);
      background: hsl(0 0% 0% / 0.05);
      
      @media (prefers-color-scheme: dark) {
        background: hsl(0 0% 100% / 0.05);
      }
    }
    
    code {
      word-break: break-all;
      font-family: ui-monospace, 'Cascadia Code', 'Source Code Pro', Menlo, Monaco, 'Courier New', monospace;
      font-size: 0.875em;
    }
    
    /* 内联代码 */
    code:not(pre code) {
      padding: 0.2em 0.4em;
      border-radius: var(--radius-sm);
      background: hsl(0 0% 0% / 0.05);
      font-size: 0.9em;
      
      @media (prefers-color-scheme: dark) {
        background: hsl(0 0% 100% / 0.1);
      }
    }
  }
  
  /* 容器查询样式 */
  @container (min-width: 640px) {
    .preview-content {
      pre {
        padding: 1.5rem;
      }
    }
  }
  
  /* 打印优化 */
  @media print {
    .no-print {
      display: none !important;
    }
    
    .preview-content {
      word-break: normal;
      overflow-wrap: normal;
      hyphens: none;
    }
    
    pre, code {
      white-space: pre-wrap !important;
      page-break-inside: avoid;
    }
  }
  
  /* 触摸设备优化 */
  @media (hover: none) and (pointer: coarse) {
    .scrollbar-custom::-webkit-scrollbar {
      width: 12px;
      height: 12px;
    }
    
    /* 增加触摸目标大小 */
    button, 
    a, 
    [role="button"] {
      min-height: 44px;
      min-width: 44px;
    }
  }
  
  /* 减少动画，适用于用户偏好 */
  @media (prefers-reduced-motion: reduce) {
    *,
    *::before,
    *::after {
      animation-duration: 0.01ms !important;
      animation-iteration-count: 1 !important;
      transition-duration: 0.01ms !important;
      scroll-behavior: auto !important;
    }
  }
  
  /* 高对比度模式支持 */
  @media (prefers-contrast: high) {
    :root {
      --foreground: 0 0% 0%;
      --background-start: 0 0% 100%;
      --background-end: 0 0% 100%;
    }
  }
}

/* 组件样式 */
@layer components {
  /* 如果需要，可以在这里添加组件样式 */
}

/* 关键渲染路径优化 */
@media (prefers-reduced-data: reduce) {
  body {
    background-image: none;
  }
}

/* 视口高度安全处理 */
.min-h-screen-safe {
  min-height: 100vh;
  min-height: 100svh; /* small viewport height */
  min-height: 100lvh; /* large viewport height */
  min-height: 100dvh; /* dynamic viewport height */
}